<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBTN</title>
    <!-- https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.min.css" rel="stylesheet" type="text/css"/>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/zebra_dialog@latest/dist/zebra_dialog.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/zebra_dialog@latest/dist/css/flat/zebra_dialog.min.css">

    <script src="./JS/hgv2.js"></script>
    <script src="./JS/CBTNm.js"></script>

    <style>
        html *
        {
            font-family: Arial;
        }
    </style>
</head>
<body>

<div id="container"></div>
<script>
    "use strict";

    // Get accessions for GlyGen and GlyTouCan first

    var glygen_accs, glycandata_accs;
    var accs_received = {
        "GlyGen": false,
        "GlycanData": false
    };
    d3.json("./JS/glygen_accession.json", function (d) {
        glygen_accs = d;
        accs_received["GlyGen"] = true;
        sync();
    });

    d3.json("./JS/glycandata_accession.json", function (d) {
        glycandata_accs = d;
        accs_received["GlycanData"] = true;
        sync();
    });

    function sync(){
        if ( !Object.values(accs_received).includes(false) ){
            init_CBTN();
        }
    }


    function init_CBTN() {
        var CBTNPara = {};
        var cbtn = CBTN();

        var urlobj = new URL(window.location);
        for (var p of urlobj.searchParams) {
            CBTNPara[p[0]] = p[1];
        }

        CBTNPara["div_id"] = "container";
        CBTNPara["subsumption_json_url"] = "./GNOme.browser.json";

        CBTNPara["jumps"] = [];
        CBTNPara["jumps"].push({
            "title": "GlycanData",
            "prefix": "https://edwardslab.bmcb.georgetown.edu/glycandata/",
            "suffix": "",
            "accessions": glycandata_accs
        });
        CBTNPara["jumps"].push({
            "title": "GlyGen",
            "prefix": "https://www.glygen.org/glycan_detail.html?glytoucan_ac=",
            "suffix": "",
            "accessions": glygen_accs
        });
        CBTNPara["jumps"].push({
            "title": "GlyTouCan",
            "prefix": "https://glytoucan.org/Structures/Glycans/",
            "suffix": "",
            "accessions": undefined
        });
        CBTNPara["this"] = cbtn;

        cbtn.initializeFromPara(CBTNPara);
    }

</script>

<script>

</script>

</body>
</html>
